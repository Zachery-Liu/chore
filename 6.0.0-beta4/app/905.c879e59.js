(self.webpackChunkblessing_skin_server=self.webpackChunkblessing_skin_server||[]).push([[905],{1570:function(e,t){t.w=function(e){return e}},5897:function(e,t,i){"use strict";var a=i(5944),s=i(3804),n=i(917),c=i(88);const l=n.iv`
  ::after {
    display: none;
  }
`;t.Z=e=>{var t;const i=(0,s.useRef)(null);return(0,a.BX)("div",Object.assign({className:"form-group"},{children:[(0,a.tZ)("label",Object.assign({htmlFor:"select-file"},{children:(0,c.t)("skinlib.upload.select-file")}),void 0),(0,a.BX)("div",Object.assign({className:"input-group"},{children:[(0,a.BX)("div",Object.assign({className:"custom-file"},{children:[(0,a.tZ)("input",{type:"file",className:"custom-file-input",id:"select-file",accept:e.accept,title:(0,c.t)("skinlib.upload.select-file"),ref:i,onChange:e.onChange},void 0),(0,a.tZ)("label",Object.assign({className:"custom-file-label",css:l},{children:null===(t=e.file)||void 0===t?void 0:t.name}),void 0)]}),void 0),(0,a.tZ)("div",Object.assign({className:"input-group-append"},{children:(0,a.tZ)("button",Object.assign({className:"btn btn-default",onClick:()=>{i.current.click()}},{children:(0,c.t)("skinlib.upload.select-file")}),void 0)}),void 0)]}),void 0)]}),void 0)}},6309:function(e,t,i){"use strict";var a=i(5893),s=(i(3804),i(88));t.Z=()=>(0,a.jsxs)("div",Object.assign({className:"card"},{children:[(0,a.jsx)("div",Object.assign({className:"card-header"},{children:(0,a.jsx)("div",Object.assign({className:"d-flex justify-content-between"},{children:(0,a.jsx)("h3",Object.assign({className:"card-title"},{children:(0,a.jsx)("span",{children:(0,s.t)("general.texturePreview")},void 0)}),void 0)}),void 0)}),void 0),(0,a.jsx)("div",{className:"card-body"},void 0)]}),void 0)},9341:function(e,t,i){"use strict";i.d(t,{Z:function(){return s}});var a=i(3804);function s(e,t){const[i,s]=(0,a.useState)(t);return(0,a.useEffect)((()=>{s(blessing.extra[e])}),[]),i}},9018:function(e,t,i){"use strict";i.d(t,{Z:function(){return n}});var a=i(3804),s=i(3601);function n(){(0,a.useEffect)((()=>{(0,s.j)("mounted")}),[])}},9683:function(e,t,i){"use strict";i.d(t,{Z:function(){return s}});var a=i(3804);function s(e){const t=(0,a.useRef)(null);return(0,a.useEffect)((()=>{const i=document.querySelector(e),a=document.createElement("div");return t.current=a,i.appendChild(a),()=>{i.removeChild(a),t.current=null}}),[]),t.current}},7109:function(e,t,i){"use strict";var a,s;i.d(t,{P:function(){return a},N:function(){return s}}),function(e){e[e.Banned=-1]="Banned",e[e.Normal=0]="Normal",e[e.Admin=1]="Admin",e[e.SuperAdmin=2]="SuperAdmin"}(a||(a={})),function(e){e.Steve="steve",e.Alex="alex",e.Cape="cape"}(s||(s={}))},8905:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return k}});var a=i(5893),s=i(3804),n=i.n(s),c=i(7196),l=i.n(c),r=i(1570),o=i(88),d=i(9341),u=i(9018),v=i(9683),m=i(6703),h=i(439);function f(e){return e/64}function p(e,t,i){const a=e.getImageData(t,i,1,1);return 0===a.data[0]&&0===a.data[1]&&0===a.data[2]}function g(e){return new Promise((t=>{const i=new Image;i.src=e,i.onload=()=>{if(i.width!==i.height)return void t(!1);const e=document.createElement("canvas");!function(e,t){let i=!1;if(t.width!==t.height){if(t.width!==2*t.height)throw new Error(`Bad skin size: ${t.width}x${t.height}`);i=!0}const a=e.getContext("2d");if(i){const i=t.width;e.width=i,e.height=i,a.clearRect(0,0,i,i),a.drawImage(t,0,0,i,i/2),function(e,t){const i=f(t),a=(t,a,s,n,c,l,r)=>function(e,t,i,a,s,n,c,l){const r=e.getImageData(t,i,a,s);if(l)for(let e=0;e<s;e++)for(let t=0;t<a/2;t++){const i=4*(t+e*a),s=4*(a-t-1+e*a),n=r.data[i],c=r.data[i+1],l=r.data[i+2],o=r.data[i+3],d=r.data[s],u=r.data[s+1],v=r.data[s+2],m=r.data[s+3];r.data[i]=d,r.data[i+1]=u,r.data[i+2]=v,r.data[i+3]=m,r.data[s]=n,r.data[s+1]=c,r.data[s+2]=l,r.data[s+3]=o}e.putImageData(r,n,c)}(e,t*i,a*i,s*i,n*i,c*i,l*i,r);!function(e,t){if(!function(e,t,i,a,s){const n=e.getImageData(t,i,a,s);for(let e=0;e<a;e++)for(let t=0;t<s;t++){const i=4*(e+t*a);if(255!==n.data[i+3])return!0}return!1}(e,0,0,t,t/2)){const i=f(t),a=(t,a,s,n)=>e.clearRect(t*i,a*i,s*i,n*i);a(40,0,8,8),a(48,0,8,8),a(32,8,8,8),a(40,8,8,8),a(48,8,8,8),a(56,8,8,8)}}(e,t),a(4,16,4,4,20,48,!0),a(8,16,4,4,24,48,!0),a(0,20,4,12,24,52,!0),a(4,20,4,12,20,52,!0),a(8,20,4,12,16,52,!0),a(12,20,4,12,28,52,!0),a(44,16,4,4,36,48,!0),a(48,16,4,4,40,48,!0),a(40,20,4,12,40,52,!0),a(44,20,4,12,36,52,!0),a(48,20,4,12,32,52,!0),a(52,20,4,12,44,52,!0)}(a,i)}else e.width=t.width,e.height=t.height,a.clearRect(0,0,t.width,t.height),a.drawImage(t,0,0,e.width,e.height)}(e,i);const a=e.width/64,s=e.getContext("2d");if(s){for(let e=46*a;e<48*a;e+=1)for(let i=52*a;i<64*a;i+=1)if(!p(s,e,i))return void t(!1);t(!0)}else t(!1)}}))}var b=i(7109),j=i(8848),x=i(5897),N=i(6309);const w=n().lazy((()=>Promise.all([i.e(574),i.e(308),i.e(613)]).then(i.bind(i,1997))));var k=(0,r.w)((()=>{var e;const[t,i]=(0,s.useState)(""),[c,r]=(0,s.useState)(b.N.Steve),[f,p]=(0,s.useState)(!1),[k,y]=(0,s.useState)(!1),[O,Z]=(0,s.useState)(null),[C,S]=(0,s.useState)(""),A=(0,d.Z)("rule"),I=(0,d.Z)("contentPolicy"),_=(0,d.Z)("privacyNotice"),E=(0,d.Z)("award"),P=(0,d.Z)("score",0),B=(0,d.Z)("scorePublic"),F=(0,d.Z)("scorePrivate"),R=(0,d.Z)("closetItemCost"),D=(0,v.Z)("#previewer");(0,u.Z)();const z=e=>{r(e.target.value)},L=f?F:B,T=null!==(e=null==O?void 0:O.size)&&void 0!==e?e:0,U=Math.ceil(T/1024)*L+R;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",Object.assign({className:"card card-primary"},{children:[(0,a.jsxs)("div",Object.assign({className:"card-body"},{children:[(0,a.jsxs)("div",Object.assign({className:"form-group"},{children:[(0,a.jsx)("label",Object.assign({htmlFor:"texture-name"},{children:(0,o.t)("skinlib.upload.texture-name")}),void 0),(0,a.jsx)("input",{className:"form-control",id:"texture-name",type:"text",placeholder:A,value:t,onChange:e=>{i(e.target.value)}},void 0)]}),void 0),(0,a.jsxs)("div",Object.assign({className:"form-group"},{children:[(0,a.jsx)("label",{children:(0,o.t)("skinlib.upload.texture-type")},void 0),(0,a.jsx)("br",{},void 0),(0,a.jsxs)("label",Object.assign({className:"mr-4"},{children:[(0,a.jsx)("input",{type:"radio",className:"mr-1",name:"type",value:"steve",checked:c===b.N.Steve,onChange:z},void 0),"Steve"]}),void 0),(0,a.jsxs)("label",Object.assign({className:"mr-4"},{children:[(0,a.jsx)("input",{type:"radio",className:"mr-1",name:"type",value:"alex",checked:c===b.N.Alex,onChange:z},void 0),"Alex"]}),void 0),(0,a.jsxs)("label",Object.assign({className:"mr-4"},{children:[(0,a.jsx)("input",{type:"radio",className:"mr-1",name:"type",value:"cape",checked:c===b.N.Cape,onChange:z},void 0),(0,o.t)("general.cape")]}),void 0)]}),void 0),(0,a.jsx)(x.Z,{file:O,accept:"image/png, image/x-png",onChange:async e=>{const a=e.target.files,[s]=a;if(s){Z(s),!t&&s.name.endsWith(".png")&&i(s.name.slice(0,s.name.length-4));const e=URL.createObjectURL(s);S(e),c!==b.N.Cape&&r(await g(e)?b.N.Alex:b.N.Steve)}}},void 0),I&&(0,a.jsx)("div",{className:"callout callout-warning",dangerouslySetInnerHTML:{__html:I}},void 0)]}),void 0),(0,a.jsxs)("div",Object.assign({className:"card-footer"},{children:[(0,a.jsxs)("div",Object.assign({className:"container px-0 d-flex justify-content-between"},{children:[(0,a.jsxs)("label",Object.assign({className:"mt-2",htmlFor:"is-private",title:(0,o.t)("skinlib.upload.privacy-notice")},{children:[(0,a.jsx)("input",{type:"checkbox",id:"is-private",className:"mr-1",checked:f,onChange:e=>{p(e.target.checked)}},void 0),(0,o.t)("skinlib.upload.set-as-private")]}),void 0),(0,a.jsx)("button",Object.assign({className:"btn btn-success",disabled:k,onClick:async()=>{if(!O)return void h.A.error((0,o.t)("skinlib.emptyUploadFile"));if(!t)return void h.A.error((0,o.t)("skinlib.emptyTextureName"));if("image/png"!==O.type&&"image/x-png"!==O.type)return void h.A.error((0,o.t)("skinlib.fileExtError"));const e=new FormData;e.append("name",t),e.append("type",c),e.append("file",O,O.name),e.append("public",f?"0":"1"),y(!0);const{code:i,message:a,data:{tid:s}={tid:0}}=await m.v_(j.Z.texture.upload(),e);if(y(!1),0===i)window.location.href=blessing.base_url+j.Z.skinlib.show(s);else if(2===i)try{await(0,h.K)({mode:"confirm",text:a,okButtonText:(0,o.t)("user.viewInSkinlib")}),window.location.href=blessing.base_url+j.Z.skinlib.show(s)}catch(e){}else h.A.error(a)}},{children:k?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"fas fa-spinner fa-spin mr-1"},void 0),(0,a.jsx)("span",{children:(0,o.t)("skinlib.uploading")},void 0)]},void 0):(0,o.t)("skinlib.upload.button")}),void 0)]}),void 0),O&&(0,a.jsxs)("div",Object.assign({className:`callout callout-${P>U?"success":"danger"} mt-3`},{children:[(0,a.jsx)("div",{children:(0,o.t)("skinlib.upload.cost",{score:U})},void 0),(0,a.jsxs)("div",{children:[(0,o.t)("user.cur-score"),(0,a.jsx)("span",Object.assign({className:"ml-1"},{children:P}),void 0)]},void 0)]}),void 0),f&&(0,a.jsx)("div",Object.assign({className:"callout callout-info mt-3"},{children:_}),void 0),!f&&E>0&&(0,a.jsx)("div",Object.assign({className:"callout callout-success mt-3"},{children:(0,o.t)("skinlib.upload.award",{score:E})}),void 0)]}),void 0)]}),void 0),D&&l().createPortal((0,a.jsx)(n().Suspense,Object.assign({fallback:(0,a.jsx)(N.Z,{},void 0)},{children:(0,a.jsx)(w,{skin:c!==b.N.Cape?C:void 0,cape:c===b.N.Cape?C:void 0,isAlex:c===b.N.Alex},void 0)}),void 0),D)]},void 0)}))}}]);